import React, { useState } from 'react';

const API_URL = '/chat';

export default function ChatPage() {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);

  const sendMessage = async () => {
    if (!input.trim()) return;
    const userMsg = { sender: 'user', text: input };
    setMessages(msgs => [...msgs, userMsg]);
    setLoading(true);
    setInput('');
    try {
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: input })
      });
      const data = await res.json();
      setMessages(msgs => [...msgs, { sender: 'bot', text: data.reply }]);
      console.log('Bot reply:', messages);
    } catch (e) {
      setMessages(msgs => [...msgs, { sender: 'bot', text: 'เกิดข้อผิดพลาด กรุณาลองใหม่' }]);
    }
    setLoading(false);
  };
    // Simulate bot response for demo purposes
//     setTimeout(() => {
//                 setMessages([
//     {
//         "sender": "user",
//         "text": "กราบนมัสการครับ"
//     },
//     {
//         "sender": "bot",
//         "text": "กราบนมัสการโยมอย่างสูง อาตมาขออนุโมทนาที่โยมน้อมใจมาหาธรรมะในวันนี้ ยินดีอย่างยิ่งที่จะได้แบ่งปันคำสอนของพระพุทธเจ้าเพื่อประโยชน์แก่จิตใจของโยม ขอให้โยมตั้งใจฟังด้วยใจที่สงบและเปิดกว้างนะโยม."
//     },
//     {
//         "sender": "user",
//         "text": "หลวงพ่อคิดอย่างไรกับการนอกใจครับ"
//     },
//     {
//         "sender": "bot",
//         "text": "โยมที่เคารพ การนอกใจนั้นเป็นเรื่องที่ทำให้ใจของทั้งตนเองและผู้อื่นเกิดความทุกข์ใจมาก การนอกใจเป็นไปในทางที่ขัดกับความสัตย์ซื่อและเมตตาต่อกัน ซึ่งเป็นธรรมะสำคัญที่บ่งบอกถึงความดีงามของจิตใจ\n\nพระพุทธองค์ทรงสอนให้เราฝึกตนด้วยความซื่อสัตย์ และไม่เบียดเบียนผู้อื่นด้วยคำพูดหรือการกระทำ การนอกใจเป็นการเบียดเบียนใจผู้อื่นและทำลายความไว้วางใจ ซึ่งจะนำมาซึ่งความทุกข์และความไม่สงบในใจ\n\nอาตมาขอแนะให้โยมพิจารณาดูใจของตนเองว่า การนอกใจนั้นเกิดจากกิเลสเช่น โลภะ โทสะ หรือโมหะ หรือไม่ แล้วจงฝึกสติและเมตตาต่อผู้อื่น รวมทั้งตนเอง เพื่อจะได้ละความเห็นแก่ตัวและความโลภในใจ\n\nดังที่หลวงพ่อชา สุภัทโท ท่านเคยกล่าวไว้ว่า \"จิตใจที่สงบ ย่อมนำมาซึ่งความสุขที่แท้จริง\" การรักษาความสัตย์ซื่อในความสัมพันธ์จึงเป็นหนทางหนึ่งที่จะช่วยให้ใจสงบและเป็นสุข\n\nอาตมาขอให้โยมเจริญสติปัฏฐาน ด้วยความเมตตาและความจริงใจในทุกความสัมพันธ์ เพื่อความสงบสุขในใจของโยมเองและผู้อื่นด้วยเทอญ."
//     },
//     {
//         "sender": "user",
//         "text": "ทำไมผมถึงต้องเอาของให้พระด้วยครับ พระทำงานหาเองไม่ได้หรอ"
//     },
//     {
//         "sender": "bot",
//         "text": "โยมเอ๋ย การถวายของแก่พระสงฆ์นั้น เป็นธรรมเนียมปฏิบัติที่มีมาแต่โบราณในพระพุทธศาสนา เพื่อเป็นการสนับสนุนและส่งเสริมให้พระสงฆ์มีชีวิตเรียบง่าย และสามารถทุ่มเทเวลาศึกษาและปฏิบัติธรรมได้อย่างเต็มที่ พระสงฆ์ไม่มีอาชีพทำงานหาเงินเหมือนฆราวาส เพราะต้องรักษาศีลและปฏิบัติธรรมนั้นเอง\n\nอย่างที่พระอาจารย์ชอบสอนว่า \"การให้ทานคือการสร้างบุญ เป็นการฝึกใจให้ไม่ยึดติดกับวัตถุ\" การถวายของจึงเป็นโอกาสให้โยมได้ฝึกใจเมตตา กรุณา และปล่อยวางความยึดมั่นถือมั่นในทรัพย์สินของตน\n\nดังนั้น การถวายของแก่พระสงฆ์ไม่ใช่เพียงการให้สิ่งของ แต่เป็นการสร้างความสัมพันธ์ระหว่างโยมกับพระสงฆ์ ให้เกิดความสามัคคีและความเจริญในทางธรรมร่วมกัน อาตมาขอเชิญโยมพิจารณาดูใจของโยมในขณะถวายว่ามีความตั้งใจอย่างไร เพื่อจะได้เข้าใจธรรมะอันลึกซึ้งยิ่งขึ้น."
//     },
//     {
//         "sender": "user",
//         "text": "แต่ว่า ก็มีข่าวมาตลอดที่ผ่านมานะ ว่าพระเอาเงินถวายไปให้สีกา ไปเล่นการพนันอ่ะ"
//     },
//     {
//         "sender": "bot",
//         "text": "โยมที่เคารพ การที่พระภิกษุจะใช้เงินที่ได้รับจากโยมไปในทางที่ไม่เหมาะสม เช่น การพนัน หรือการให้สีกา ถือเป็นการผิดวินัยสงฆ์อย่างร้ายแรง พระภิกษุควรดำรงชีวิตด้วยความเรียบง่าย มีความซื่อสัตย์และประพฤติปฏิบัติตามพระธรรมวินัยอย่างเคร่งครัด พระพุทธองค์ทรงวางหลักให้พระภิกษุไม่พึงข้องเกี่ยวกับสิ่งที่ทำให้ใจฟุ้งซ่านหรือเป็นบ่อเกิดแห่งทุกข์\n\nเมื่อมีข่าวเช่นนี้เกิดขึ้น อาตมาขอแนะนำให้โยมใช้ปัญญาในการพิจารณา และไม่รีบเชื่อโดยไม่มีหลักฐานแน่ชัด การฟังข่าวหรือการกล่าวหาโดยไม่มีความระมัดระวัง อาจทำให้เกิดความเข้าใจผิดและทำลายความศรัทธาได้\n\nหากโยมพบเห็นพระภิกษุท่านใดประพฤติผิดวินัยจริง โยมสามารถแจ้งต่อเจ้าคณะหรือผู้รับผิดชอบในคณะสงฆ์ เพื่อให้ดำเนินการตามพระธรรมวินัยอย่างถูกต้อง อาตมาขอให้โยมตั้งจิตเมตตา เข้าใจในธรรมชาติของมนุษย์และพยายามเจริญสติปัฏฐาน ดูใจตนเองให้มั่นคง\n\n\"ใจที่สงบเป็นที่พึ่งอันประเสริฐ\" อาตมาขอให้โยมเจริญในธรรมและมีสติปัญญาในการดำเนินชีวิตต่อไป."
//     },
//     {
//         "sender": "user",
//         "text": "เค้ามีหลักฐานนะครับ ตอนนี้พระรูปนั้นก็ศึกแล้วด้วย ผมรู้สึกไม่สบายที่จะทำบุณเลยตอนนี้"
//     },
//     {
//         "sender": "bot",
//         "text": "โยมที่เคารพ การทำบุญนั้นเป็นการสั่งสมกุศล คือการเจริญเมตตา กรุณา มุทิตา และอุเบกขาในจิตใจของโยมเอง หากโยมรู้สึกไม่สบายใจในขณะนี้ อาตมาขอแนะนำให้โยมตั้งจิตใจให้สงบก่อน แล้วค่อยพิจารณาว่าจะทำบุญอย่างไรในเวลาที่เหมาะสม\n\nบ่อยครั้งที่ความสงบในจิตใจเป็นสิ่งสำคัญกว่าการทำบุญอย่างรีบร้อน เพราะการทำบุญด้วยจิตใจที่ไม่สงบ อาจไม่เกิดผลอย่างแท้จริง ดังที่พระอาจารย์ชาวป่าท่านเคยสอนว่า “ใจที่สงบคือบุญที่แท้จริง” \n\nอาตมาขอให้โยมน้อมนำคำสอนของพระพุทธเจ้า มาฝึกเจริญสติให้มั่นคง แล้วจึงค่อยกลับมาทำบุญในเวลาที่จิตใจพร้อม จะเป็นประโยชน์ยิ่งกว่า\n\nขอให้โยมเจริญในธรรมและมีสติปัญญาในการดำเนินชีวิตต่อไปอย่างมั่นคง  \n"
//     },
//     {
//         "sender": "user",
//         "text": "พระอาจารย์ชาวป่าคือใครหรอครับ"
//     },
//     {
//         "sender": "bot",
//         "text": "โยมครับ พระอาจารย์ชาวป่า หมายถึงพระภิกษุสงฆ์ในสายปฏิบัติที่เน้นการปลีกวิเวกอยู่ในป่า เพื่อเจริญสมาธิภาวนาและปฏิบัติธรรมตามแนวทางของพระพุทธเจ้าอย่างเคร่งครัด สายป่านี้จะเน้นการใช้ชีวิตอย่างเรียบง่าย ไม่ยึดติดกับความสะดวกสบาย และมุ่งเน้นการฝึกจิตให้สงบ อันเป็นฐานที่มั่นคงสำหรับการเห็นธรรม\n\nตัวอย่างพระอาจารย์ชาวป่าที่มีชื่อเสียงในประเทศไทย เช่น พระอาจารย์ชาวป่า อาจารย์มั่น ภูริทัตโต และพระอาจารย์ชา สุภัทโท พระอาจารย์เหล่านี้ได้สอนให้เห็นถึงความสำคัญของการเจริญสติและสมาธิ เพื่อให้ใจไม่ฟุ้งซ่าน มีความรู้แจ้งเห็นจริงในธรรมชาติของชีวิต\n\nท่านพระอาจารย์มั่นเคยกล่าวว่า \"การปฏิบัติธรรมต้องอยู่กับความจริง ไม่ใช่อยู่กับความคิด\" ซึ่งหมายความว่า เราควรตั้งใจอยู่กับปัจจุบัน ไม่วอกแวกไปกับความคิดฟุ้งซ่านทั้งหลาย\n\nโยมจงจำไว้ว่าการเดินทางในทางธรรมต้องอาศัยความเพียรและความอดทน หากมีความตั้งใจจริง อาตมาขอให้โยมเจริญในธรรมด้วยดีเถิด."
//     },
//     {
//         "sender": "user",
//         "text": "แล้วหลวงพ่อบรรลุหรือยังครับ"
//     },
//     {
//         "sender": "bot",
//         "text": "โยมที่เคารพ ใจของหลวงพ่อก็เหมือนกับใจของทุกท่าน เป็นใจที่ยังต้องเจริญภาวนาอบรมอยู่เสมอ การบรรลุธรรม มิใช่เพียงแค่คำพูดหรือสถานะ แต่คือการรู้แจ้งจริงในธรรมชาติของจิต และการดับทุกข์อย่างแท้จริง\n\nหลวงพ่อจึงตั้งใจเจริญสติ สมาธิ และปัญญาอย่างต่อเนื่อง ตามคำสอนของพระพุทธเจ้า เพื่อให้ก้าวหน้าในทางนั้นต่อไป\n\nดังที่พระอาจารย์ชา สุภัทโท ท่านกล่าวไว้ว่า \"การภาวนาไม่ใช่เพื่อบรรลุ แต่เพื่อรู้ความจริง\" โยมจงตั้งใจฝึกฝนใจให้สงบและเห็นความจริงในชีวิตประจำวันเถิด สติปัญญาจะเจริญขึ้นเองตามเหตุปัจจัย\n\nอาตมาขอให้โยมมีความเพียรในการปฏิบัติธรรม และใจที่ผ่องใสอยู่เสมอ."
//     }
// ])
//         setLoading(false);
//         }, 1000);
  return (
    <div style={{ fontFamily: 'Sarabun, sans-serif', background: '#f6f7f4', minHeight: '100vh', padding: 0, margin: 0 }}>
      <div style={{ width: '80vw', maxWidth: '1200px', margin: '0 auto', padding: 24, background: '#fff', borderRadius: 16, boxShadow: '0 2px 8px #0001', marginTop: 48, height: '80vh', display: 'flex', flexDirection: 'column' }}>
        <h2 style={{ color: '#6b705c', textAlign: 'center', marginBottom: 24 }}>🍃 ธรรมะแชต</h2>
        <div style={{ flex: 1, minHeight: 200, marginBottom: 16, overflowY: 'auto', maxHeight: 'calc(80vh - 160px)' }}>
          {messages.map((msg, i) => (
            <div key={i} style={{
              display: 'flex',
              flexDirection: msg.sender === 'user' ? 'row-reverse' : 'row',
              alignItems: 'flex-start',
              textAlign: msg.sender === 'user' ? 'right' : 'left',
              margin: '16px 0'
            }}>
              {msg.sender === 'bot' && (
                <img src="/monk.png" alt="" height={'28px'} width={'28px'} style={{ marginRight: 8 }} />
              )}
              <span style={{
                display: 'inline-block',
                background: msg.sender === 'user' ? '#e9ecef' : '#d8f3dc',
                color: '#333',
                borderRadius: 12,
                padding: '8px 16px',
                maxWidth: '80%',
                fontSize: 16
              }}>{msg.text}</span>
            </div>
          ))}
          {loading && <div style={{ color: '#aaa', fontStyle: 'italic' }}>กำลังตอบ...</div>}
        </div>
        <div style={{ display: 'flex', gap: 8 }}>
          <input
            type="text"
            value={input}
            placeholder="ถามสิ่งที่อยากรู้..."
            style={{ flex: 1, padding: 12, borderRadius: 8, border: '1px solid #ddd', fontSize: 16 }}
            onChange={e => setInput(e.target.value)}
            onKeyDown={e => { if (e.key === 'Enter') sendMessage(); }}
            disabled={loading}
          />
          <button
            onClick={sendMessage}
            style={{ background: '#b7e4c7', color: '#222', border: 'none', borderRadius: 8, padding: '0 20px', fontSize: 16, cursor: 'pointer' }}
            disabled={loading}
          >ส่ง</button>
        </div>
      </div>
    </div>
  );
}
